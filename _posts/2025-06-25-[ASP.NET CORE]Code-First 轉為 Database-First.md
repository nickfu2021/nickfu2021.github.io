
# C# å°ˆæ¡ˆå¾ Code-First è½‰ç‚º Database-First ç­†è¨˜

## âœ… ä»€éº¼æ˜¯ Code-Firstï¼Ÿ
- åœ¨ C# ä¸­å…ˆå®šç¾©å¥½ Models
- ç”¨ `dotnet ef migrations add` å»ºç«‹ migration
- ç”¨ `dotnet ef database update` å»ºç«‹è³‡æ–™è¡¨

## âœ… ä»€éº¼æ˜¯ Database-Firstï¼Ÿ
- å…ˆåœ¨è³‡æ–™åº«ï¼ˆå¦‚ PostgreSQLï¼‰å»ºå¥½è³‡æ–™è¡¨
- ç”¨ `Scaffold-DbContext` æŒ‡ä»¤è‡ªå‹•ç”¢ç”Ÿ Model + DbContext
- æˆ–æ‰‹å‹•å¯« Modelï¼Œé…åˆ EF ä½¿ç”¨

---

## âŒ Code-First è½‰ Database-First æ™‚å¸¸è¦‹å•é¡Œ

### å•é¡Œï¼šEF å˜—è©¦æ¯”å° migrationï¼Œå°è‡´éŒ¯èª¤æˆ–è¡çª

### åŸå› ï¼š
- ä½ æ›¾ç¶“åŸ·è¡Œ `dotnet ef migrations add`ï¼ŒEF è¨˜éŒ„å·²å¯«å…¥
- è³‡æ–™åº«ä¸­å­˜åœ¨ `__EFMigrationsHistory` è¡¨

---

## âœ… æ­£ç¢ºè½‰æ›æ­¥é©Ÿ

### æ­¥é©Ÿ 1ï¼šåˆªé™¤èˆŠ migration æª”æ¡ˆ
åˆªé™¤ `Migrations/` è³‡æ–™å¤¾ï¼ˆåŒ…å« `InitCreate.cs`, `ModelSnapshot.cs` ç­‰ï¼‰

### æ­¥é©Ÿ 2ï¼šå¯é¸æ“‡åˆªé™¤è³‡æ–™åº«å…§é·ç§»ç´€éŒ„
```sql
DROP TABLE IF EXISTS "__EFMigrationsHistory";
```

### æ­¥é©Ÿ 3ï¼šæ‰‹å‹•å»ºç«‹ Model æˆ– Scaffold Model
- æ‰‹å‹•å¯« `Events.cs`, `Customers.cs`, `Orders.cs`
- æˆ–ä½¿ç”¨ Scaffold æŒ‡ä»¤ï¼š

```bash
dotnet ef dbcontext scaffold "Host=localhost;Port=5432;Database=è³‡æ–™åº«å;Username=å¸³è™Ÿ;Password=å¯†ç¢¼" Npgsql.EntityFrameworkCore.PostgreSQL -o Models -f
```

### æ­¥é©Ÿ 4ï¼šè¨­å®š DbContext èˆ‡é€£ç·šå­—ä¸²
åœ¨ `Program.cs` ä¸­è¨»å†Šä½ çš„ DbContextï¼š

```csharp
builder.Services.AddDbContext<AppDbContext>(options =>
    options.UseNpgsql(builder.Configuration.GetConnectionString("DefaultConnection")));
```

åœ¨ `appsettings.json` è¨­å®šé€£ç·šï¼š

```json
"ConnectionStrings": {
  "DefaultConnection": "Host=localhost;Port=5432;Database=è³‡æ–™åº«å;Username=å¸³è™Ÿ;Password=å¯†ç¢¼"
}
```

---

## âœ… æ³¨æ„äº‹é …

- âŒ ä¸è¦å†ä½¿ç”¨ `dotnet ef migrations add`
- âœ… Model è¦ç”¨ `[Table]`ã€`[Column]` æŒ‡å®šå°æ‡‰æ¬„ä½
- âœ… `DateTime` å»ºè­°æ­é… `TypeName = "date"` é¿å…æ™‚å€éŒ¯èª¤

---

## ğŸ¯ é©åˆçš„é–‹ç™¼æµç¨‹ï¼ˆDatabase-Firstï¼‰

1. æ‰‹å‹•å»ºç«‹è³‡æ–™è¡¨
2. Scaffold Model æˆ–æ‰‹å‹•æ’°å¯« Model
3. æ’°å¯« API èˆ‡è³‡æ–™é©—è­‰é‚è¼¯
4. æ’°å¯«å‰ç«¯ç³»çµ±ï¼ˆå¦‚ Next.jsï¼‰
5. éƒ¨ç½²

